(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();let a=0;async function u(){const i=(await navigator.mediaDevices.enumerateDevices()).filter(d=>d.kind==="videoinput"),c=i[a%i.length].deviceId;console.log(i[a%i.length].deviceId);const n=await navigator.mediaDevices.getUserMedia({video:{width:1920,height:1080,deviceId:c},audio:!1}),t=document.querySelector("#video"),e=document.querySelector(".box");t.autoplay=!0,t.srcObject=n,await new Promise(d=>{t.onloadedmetadata=d});const o=t.clientWidth,r=t.clientHeight,s=t.videoWidth,h=t.videoHeight,g=115,p=35,l=Math.min(o/s,r/h),f=g*l,m=p*l;e.style.setProperty("--width",`${t.clientWidth}px`),e.style.setProperty("--height",`${t.clientHeight}px`),e.style.setProperty("--clip-width",`${f}px`),e.style.setProperty("--clip-height",`${m}px`)}function y(i){const c=document.createElement("canvas"),n=c.getContext("2d");if(n===null)throw new Error("ctx null");const t=115,e=35;c.width=t,c.height=e;const o=(i.videoWidth-t)/2,r=(i.videoHeight-e)/2;n.strokeStyle="red",n.lineWidth=3,n.drawImage(i,o,r,t,e,0,0,t,e);const s=c.toDataURL("image/jpeg",.5);return console.log(s),s}function v(i){fetch("/img",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({img:i})})}u();const w=document.querySelector(".takepic");w.addEventListener("click",()=>{const i=document.querySelector("#video"),c=y(i);v(c)});const x=document.querySelector(".rotate");x.addEventListener("click",()=>{a++,u()});
